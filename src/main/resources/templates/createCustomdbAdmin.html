

<html>

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <link rel="apple-touch-icon" sizes="180x180" th:href="@{/app-assets/apple-touch-icon.png}">
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/app-assets/favicon-32x32.png}">
    <link rel="icon" type="image/png" sizes="16x16" th:href="@{/app-assets/favicon-16x16.png}">
    <link rel="manifest" th:href="@{/app-assets/site.webmanifest}">

    <title>Create Custom DB | Dashboard</title>

    <!-- Custom fonts for this template-->
    <link th:href="@{/app-assets/vendor/fontawesome-free/css/all.min.css}" rel="stylesheet" type="text/css">
    <link
            href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
            rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"/>


    <!-- Custom styles for this template-->
    <link th:href="@{/app-assets/css/sb-admin-2.min.css}" rel="stylesheet">

</head>

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <div th:replace="admin_sidebar :: admin_sidebar"></div>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- Topbar -->

            <div th:replace="admin_navbar :: admin_navbar"></div>


            <!-- Begin Page Content -->
            <div class="container-fluid">



                <div class="card o-hidden border-0 shadow-lg my-5">
                    <div class="card-body p-0">
                        <!-- Nested Row within Card Body -->


                        <div class="row">
                            <div class="col-lg-12">
                                <div class="p-5">

                                    <form class="customDb" id="createTaskForm" method="POST" enctype="utf8">

                                        <div class="col px-1 mb-2">
                                            <p>You can create a custom DB and use it to be used in a Task of a Hackathon. The DB can be reused for many tasks. The Queries  for Custom DB will be a set of queries that will execute on the Database creation. Since this is a custom database, when a task is created with this database, and the user executes submission on this task, during the hackathon, another temporary database will be created for the task submission using the Database queries given below. Then, the user submitted query will be executed against the new temporary database. After this, the temporary database will be deleted.</p>

                                            <p><b>Please make sure you enter a valid Database name. It will sanitize your input automatically.</b></p>
                                        </div>
                                        <div class="col px-1 mb-2">
                                            <label for="name" class="ms-2 position-absolute" style="margin-top: -0.25rem !important">
                                                <span class="h6 small bg-white text-muted px-1">Database Name (required)</span>
                                            </label>
                                            <input type="text" class="form-control mt-2" id="name" name="name" required="required" oninput="sanitizeInput(this)">
                                            <span id="nameError" class="alert alert-danger col-sm-12" style="display:none"></span>

                                        </div>

                                        <br/>





                                        <div class="col px-1 mb-2">
                                            <label for="description" class="ms-2 position-absolute" style="margin-top: -0.25rem !important">
                                                <span class="h6 small bg-white text-muted px-1">Description (required)</span>
                                            </label>
                                            <textarea type="text" class="form-control mt-2" id="description" name="description" rows="6" cols="100" required="required"> </textarea>
                                            <span id="descriptionError" class="alert alert-danger col-sm-12" style="display:none"></span>

                                        </div>

                                        <br/>

                                        <div class="col px-1 mb-2">
                                            <p>Private Notes can be viewed by Admins only.</p>
                                            <label for="privateNotes" class="ms-2 position-absolute"
                                                   style="margin-top: -0.25rem !important">
                                                <span class="h6 small bg-white text-muted px-1">Private Notes (optional)</span>
                                            </label>
                                            <textarea type="text" class="form-control mt-2" id="privateNotes"
                                                      name="privateNotes" rows="3"
                                                      cols="100"> </textarea>
                                        </div>

                                        <br/>

                                        <div class="col px-1 mb-2">
                                            <label for="query" class="ms-2 position-absolute" style="margin-top: -0.25rem !important">
                                                <span class="h6 small bg-white text-muted px-1">Queries for Custom DB (required)</span>
                                            </label>
                                            <textarea type="text" class="form-control mt-2" id="query" name="query" rows="10" cols="100" required="required"> </textarea>
                                            <span id="queryError" class="alert alert-danger col-sm-12" style="display:none"></span>

                                        </div>



                                        <br/>

                                        <div class="form-group">
                                            <span id="globalError" class="alert alert-danger col-sm-10" style="display:none"></span>
                                            <span id="globalSuccess" class="alert alert-success col-sm-10 align-items-center" style="display:none">Custom Database created!</span>

                                        </div>

                                        <button type="submit" class="btn btn-primary btn-user btn-block" >Create Custom DB</button>


                                    </form>


                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
         <footer th:replace="footer :: footer"></footer>
        <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>



<!-- Bootstrap core JavaScript-->

<script th:src="@{/app-assets/vendor/jquery/jquery.min.js}"></script>
<script th:src="@{/app-assets/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>

<!-- Core plugin JavaScript-->
<script th:src="@{/app-assets/vendor/jquery-easing/jquery.easing.min.js}"></script>

<!-- Custom scripts for all pages-->
<script th:src="@{/app-assets/js/sb-admin-2.min.js}"></script>

<!-- Page level plugins -->
<!-- Page level custom scripts <script th:src="@{/app-assets/vendor/chart.js/Chart.min.js}"></script>


<script th:src="@{/app-assets/js/demo/chart-area-demo.js}"></script>
<script th:src="@{/app-assets/js/demo/chart-pie-demo.js}"></script> -->




<script th:inline="javascript">
    var serverContext = [[@{/}]];

        $(document).ready(function () {
            $('form').submit(function(event) {
                register(event);
            });

        });


    function register(event){

        // window.alert("i am here!");

        event.preventDefault();
        $(".alert").html("").hide();
        $(".error-list").html("");
        var description = $("#description").val();
        var query = $("#query").val();

        // Check if the description is empty
        if (description.trim() === "") {
            // Display an error message or prevent the submission
            $("#descriptionError").show().append("Description is required.<br/>");
            return; // Stop the function here
        }
        if (query.trim() === "") {
            // Display an error message or prevent the submission
            $("#queryError").show().append("Query is required.<br/>");
            return; // Stop the function here
        }


        var formData= $('form').serialize();
        $.post(serverContext + "customdb/create",formData ,function(data){
            if(data.message == "Successful!"){
                $("#globalSuccess").show().append("Custom DB Created! <br/>");
                document.getElementById("createCustomDbForm").reset();
            } else{
                $("#globalError").show().append(data.message+"<br/>");
            }
        }).fail(function(data) {
                $("#globalError").show().append(data.message+"<br/>");
            });
    }

</script>


<script>
    function sanitizeInput(inputElement) {
        let inputValue = inputElement.value;

        // Replace spaces with underscores
        inputValue = inputValue.replace(/\s/g, '_');

        // Remove non-alphanumeric characters
        inputValue = inputValue.replace(/[^a-zA-Z0-9_]/g, '');

        // Ensure it starts with a letter or an underscore
        if (/^[^a-zA-Z_]/.test(inputValue)) {
            inputValue = '_' + inputValue;
        }

        // Limit the name to 64 characters
        if (inputValue.length > 64) {
            inputValue = inputValue.substring(0, 64);
        }

        // Update the input with the sanitized value
        inputElement.value = inputValue;
    }
</script>

</body>

</html>