

<html>

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Edit User | Dashboard</title>

    <link rel="apple-touch-icon" sizes="180x180" th:href="@{/app-assets/apple-touch-icon.png}">
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/app-assets/favicon-32x32.png}">
    <link rel="icon" type="image/png" sizes="16x16" th:href="@{/app-assets/favicon-16x16.png}">
    <link rel="manifest" th:href="@{/app-assets/site.webmanifest}">


    <!-- Custom fonts for this template-->
    <link th:href="@{/app-assets/vendor/fontawesome-free/css/all.min.css}" rel="stylesheet" type="text/css">
    <link
            href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
            rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"/>


    <!-- Custom styles for this template-->
    <link th:href="@{/app-assets/css/sb-admin-2.min.css}" rel="stylesheet">

</head>

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <div th:replace="admin_sidebar :: admin_sidebar"></div>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- Topbar -->

            <div th:replace="admin_navbar :: admin_navbar"></div>


            <!-- Begin Page Content -->
            <div class="container-fluid">



                <div class="card border-0 shadow rounded-3 my-5">
<!--                <div class="card o-hidden border-0 shadow-lg my-5">-->
<!--                    <div class="card-body p-0">-->
                    <div class="card-body p-4 p-sm-5">
                        <!-- Nested Row within Card Body -->
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="p-5">

                                    <form  id="createUserForm" method="POST" enctype="utf8" >



                                        <div class="form-group row">


                                            <div class="col px-1 mb-2">
                                                <label for="firstName" class="ms-2 position-absolute" style="margin-top: -0.25rem !important">
                                                    <span class="h6 small bg-white text-muted px-1">First Name</span>
                                                </label>
                                                <input type="text" class="form-control mt-2" id="firstName" name="firstName" required="required" th:value="${firstName}">
                                                <span id="firstNameError" class="alert alert-danger col-sm-12" style="display:none"></span>

                                            </div>


                                            <div class="col px-1 mb-2">
                                                <label for="lastName" class="ms-2 position-absolute" style="margin-top: -0.25rem !important">
                                                    <span class="h6 small bg-white text-muted px-1">Last Name</span>
                                                </label>
                                                <input type="text" class="form-control mt-2" id="lastName" name="lastName" required="required" th:value="${lastName}">

                                                <span id="lastNameError" class="alert alert-danger col-sm-12" style="display:none"></span>

                                            </div>

                                        </div>
                                        <div class="form-group row">

                                            <div class="col px-1 mb-2">
                                                <label for="teamName" class="ms-2 position-absolute" style="margin-top: -0.25rem !important">
                                                    <span class="h6 small bg-white text-muted px-1">Team Name</span>
                                                </label>
                                                <input type="text" class="form-control mt-2" id="teamName" name="teamName" required="required" th:value="${teamName}">

                                                <span id="teamNameError" class="alert alert-danger col-sm-12" style="display:none"></span>
                                            </div>

                                        </div>

                                        <div class="form-group row">

                                            <div class="col px-1 mb-2">
                                                <label for="email" class="ms-2 position-absolute" style="margin-top: -0.25rem !important">
                                                    <span class="h6 small bg-white text-muted px-1">Email</span>
                                                </label>
                                                <input type="email" class="form-control mt-2" id="email" name="email" required="required" th:value="${email}">

                                                <span id="emailError" class="alert alert-danger col-sm-12" style="display:none"></span>
                                            </div>

                                        </div>








                                        <div class="form-group row">


                                            <div class="col px-1 mb-2">
                                                <label for="databaseUserName" class="ms-2 position-absolute" style="margin-top: -0.25rem !important">
                                                    <span class="h6 small bg-white text-muted px-1">DB User Name</span>
                                                </label>
                                                <input type="text" class="form-control mt-2" id="databaseUserName" name="databaseUserName" required="required" th:value="${dbUserName}">
                                                <span id="databaseUserNameError" class="alert alert-danger col-sm-12" style="display:none"></span>

                                            </div>


                                            <div class="col px-1 mb-2">
                                                <label for="databaseName" class="ms-2 position-absolute" style="margin-top: -0.25rem !important">
                                                    <span class="h6 small bg-white text-muted px-1">DB Name</span>
                                                </label>
                                                <input type="text" class="form-control mt-2" id="databaseName" name="databaseName" required="required"  th:value="${dbName}">

                                                <span id="databaseNameError" class="alert alert-danger col-sm-12" style="display:none"></span>

                                            </div>

                                        </div>





<!--                                        <span> <b th:text="${employee.username}"></b></span>-->


                                        <div class="form-group row">

                                            <div class="col px-1 mb-2">
                                                <label for="password" class="ms-2 position-absolute" style="margin-top: -0.25rem !important">
                                                    <span class="h6 small bg-white text-muted px-1">Password</span>
                                                </label>
                                                <input type="text" class="form-control mt-2" id="password" name="password" required="required" value="*****" disabled="disabled">

                                                <span id="passwordError" class="alert alert-danger col-sm-12" style="display:none"></span>
                                            </div>

                                        </div>
<!--                                        <a href="login.html" class="btn btn-primary btn-user btn-block">-->
<!--                                            Create User-->
<!--                                        </a>-->
                                        <div class="form-group">
                                            <span id="globalError" class="alert alert-danger col-sm-5" style="display:none"></span>
                                            <span id="globalSuccess" class="alert alert-success col-sm-5 align-items-center" style="display:none">User updated!</span>


<!--                                            <div class="alert alert-success d-flex align-items-center" role="alert" id="globalSuccess" style="display:none">-->
<!--                                                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>-->
<!--                                                <div>-->
<!--                                                    User created!-->
<!--                                                </div>-->
<!--                                            </div>-->


                                        </div>

                                        <button type="submit" class="btn btn-primary btn-user btn-block" th:utext="#{label.form.submit}">Update User</button>



                                    </form>



                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
         <footer th:replace="footer :: footer"></footer>
        <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>



<!-- Bootstrap core JavaScript-->

<script th:src="@{/app-assets/vendor/jquery/jquery.min.js}"></script>
<script th:src="@{/app-assets/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>

<!-- Core plugin JavaScript-->
<script th:src="@{/app-assets/vendor/jquery-easing/jquery.easing.min.js}"></script>

<!-- Custom scripts for all pages-->
<script th:src="@{/app-assets/js/sb-admin-2.min.js}"></script>

<!-- Page level plugins -->
<!--<script th:src="@{/app-assets/vendor/chart.js/Chart.min.js}"></script>-->

<!--&lt;!&ndash; Page level custom scripts &ndash;&gt;-->
<!--<script th:src="@{/app-assets/js/demo/chart-area-demo.js}"></script>-->
<!--<script th:src="@{/app-assets/js/demo/chart-pie-demo.js}"></script>-->

<script th:inline="javascript">
    var serverContext = [[@{/}]];

        $(document).ready(function () {
            $('form').submit(function(event) {
                register(event);
            });

            // $(":password").keyup(function(){
            //     if($("#password").val() != $("#matchPassword").val()){
            //         $("#globalError").show().html(/*[[#{PasswordMatches.user}]]*/);
            //     }else{
            //         $("#globalError").html("").hide();
            //     }
            // });

            options = {
                common: {minChar:8},
                ui: {
                    showVerdictsInsideProgressBar:true,
                    showErrors:true,
                    errorMessages:{
                        wordLength: /*[[#{error.wordLength}]]*/,
                        wordNotEmail: /*[[#{error.wordNotEmail}]]*/,
                        wordSequences: /*[[#{error.wordSequences}]]*/,
                        wordLowercase: /*[[#{error.wordLowercase}]]*/,
                        wordUppercase: /*[[#{error.wordUppercase}]]*/,
                        wordOneNumber: /*[[#{error.wordOneNumber}]]*/,
                        wordOneSpecialChar: /*[[#{error.wordOneSpecialChar}]]*/
                    }
                }
            };
            $('#password').pwstrength(options);
        });

    function register(event){

        // window.alert("i am here!");

        event.preventDefault();
        $(".alert").html("").hide();
        $(".error-list").html("");

        var formData= $('form').serialize();
        $.post(serverContext + "user/update",formData ,function(data){
            if(data.message == "success"){


                $("#globalSuccess").show().append("User Created! <br/>");
                document.getElementById("createUserForm").reset();

                // window.location.href = serverContext + "successRegister.html";
            }

        })
            .fail(function(data) {
                if(data.responseJSON.error.indexOf("MailError") > -1)
                {
                    window.location.href = serverContext + "emailError.html";
                }
                else if(data.responseJSON.error == "UserAlreadyExist"){
                    $("#emailError").show().html(data.responseJSON.message);
                }
                else if(data.responseJSON.error == "UserDatabaseAlreadyExistException"){
                    $("#databaseNameError").show().html(data.responseJSON.message);
                }
                else if(data.responseJSON.error == "UserDatabaseUserAlreadyExistException"){
                    $("#databaseUserNameError").show().html(data.responseJSON.message);
                }
                else if(data.responseJSON.error == "UserTeamAlreadyExistException"){
                    $("#teamNameError").show().html(data.responseJSON.message);
                }
                else if(data.responseJSON.error.indexOf("InternalError") > -1){
                    window.location.href = serverContext + "login?message=" + data.responseJSON.message;
                }
                else{
                    var errors = $.parseJSON(data.responseJSON.message);
                    $.each( errors, function( index,item ){
                        if (item.field){
                            $("#"+item.field+"Error").show().append(item.defaultMessage+"<br/>");
                        }
                        else {
                            $("#globalError").show().append(item.defaultMessage+"<br/>");
                        }

                    });
                }
            });
    }

</script>

<script>
    function getUsernameFromEmail(email) {
        const parts = email.split('@');
        const username = parts[0].replace(/[^\w]/g, '_');
        return username;
    }



    const inputField1 = document.getElementById('email');
    const inputField2 = document.getElementById('databaseUserName');
    const inputField3 = document.getElementById('databaseName');

    var dbPrefix = "[[${dbPrefix}]]";

    // Add an event listener to the first input field

    inputField1.addEventListener('input', function() {
        const inputValue = inputField1.value;
        const processedValue = getUsernameFromEmail(inputValue);
        inputField2.value = processedValue;


        inputField3.value = dbPrefix+processedValue;
    });


</script>
</body>

</html>